version: '2.4'

# Docker Compose untuk Laravel App (PHP-FPM)
# Jalankan: docker-compose -f docker-compose.app.yml up -d
# Note: Jalankan Database dulu

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: smartagri-app
    restart: unless-stopped
    volumes:
      - .:/var/www
      - vendor_data:/var/www/vendor
      - storage_data:/var/www/storage
    networks:
      - smartagri-network
    environment:
      - DB_CONNECTION=pgsql
      - DB_HOST=smartagri-db
      - DB_PORT=5432
      - DB_DATABASE=smartagri
      - DB_USERNAME=smartagri
      - DB_PASSWORD=smartagri_secret
      - MQTT_HOST=smartagri-mqtt
      - MQTT_PORT=1883

networks:
  smartagri-network:
    driver: bridge
    name: smartagri-network

volumes:
  vendor_data:
  storage_data:
